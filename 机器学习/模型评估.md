## 三、模型评估、调试与优化

### 模型评估

模型评估是指通过一系列指标和方法，对机器学习模型的性能进行量化和分析的过程。评估的目的是判断模型的效果，发现模型的不足，并为模型优化提供指导。

**模型评估的重要性**
  - 衡量模型性能：通过评估指标，了解模型的预测能力。
  - 选择最优模型：在多个候选模型中选择性能最好的模型。
  - 发现模型的问题：通过评估，发现模型的过拟合、欠拟合或偏倚问题。
  - 指导模型优化：根据评估结果调整模型参数或改进特征工程。

#### 分类问题的评估
基本概念：分类问题是指预测样本属于某一类别的任务。评估分类模型的性能通常需要考虑以下几个方面：
  - 真阳性（TP）：实际为正类，预测为正类。
  - 真阴性（TN）：实际为负类，预测为负类。
  - 假阳性（FP）：实际为负类，预测为正类。
  - 假阴性（FN）：实际为正类，预测为负类。

![classify-fenxi](https://github.com/user-attachments/assets/e2e88bb5-a219-46cd-8b61-2c3b1c6c1393)


  **核心指标的定义**
  - 准确率（Accuracy）：所有预测正确的样本数占总样本数的比例。
  - 精确率（Precision）：预测为正类的样本中，实际为正类的比例。
  - 召回率（Recall）：实际为正类的样本中，被正确预测为正类的比例。
  - F1 分数（F1 Score）：精确率和召回率的调和平均值。
  **核心指标的计算**
  - 准确率：Accuracy = (TP + TN) / (TP + TN + FP + FN)  
  - 精确率：Precision = TP / (TP + FP)
  - 召回率：Recall = TP / (TP + FN)
  - F1 分数：F1 Score = 2 * (Precision * Recall) / (Precision + Recall)

ROC 曲线和 AUC 值
- ROC：Receiver Operating Characteristic Curve
- ROC曲线：接收者操作特征曲线(receiver operating characteristic curve)，是反映敏感性和特异性连续变量的综合指标，roc曲线上每个点反映着对同一信号刺激的感受性。

![auc](https://github.com/user-attachments/assets/4b3a1e70-3000-4364-ad6e-c5e9eaebd87b)


- 横坐标：FPR = FP / N，即假阳性率，假阳性率是指所有实际为负类的样本中，被错误预测为正类的比例。
- 纵坐标：TPR = TP / P，即真正类率，真正类率是指所有实际为正类的样本中，被正确预测为正类的比例。

- 理想目标：TPR=1，FPR=0，即图中(0,1)点，故ROC曲线越靠拢(0,1)点，越偏离45度对角线越好，Sensitivity、Specificity越大效果越好。

- AUC 值：Area Under Curve 曲线下的面积，表示模型的分类能力。
  - AUC = 1：完美分类
  - AUC = 0.5：随机分类
  - AUC > 0.5：好于随机分类
  - AUC < 0.5：差于随机分类

- 实例 1: 某池塘有1400条鲤鱼，300只虾，300只鳖。现在以捕鲤鱼为目的，撒一大网，逮着了700条鲤鱼，200只虾，100只鳖。那么，这些指标如何计算？
- 案例 2: 如果把池子里的所有的鲤鱼、虾和鳖都一网打尽，这些指标又有何变化?
- 案例 3：以检测游戏中的作弊玩家为例，模型的输出是0～1的闭区间中的一个数字yy，我们认为当yy大于某个threshold值时，该玩家被预测为作弊玩家。反之，yy小于该threshold值，该玩家为非作弊玩家。求 ROC 曲线。

![tp-np](https://github.com/user-attachments/assets/813ad6d4-fb11-45de-b79a-91ac07f2a878)


- 假设现在已经计算好了如下的 ROC 曲线，那么如何选择最佳的 threshold 值呢？

![optimal-roc](https://github.com/user-attachments/assets/e2e56a3c-b445-4ce2-b59f-7bb6edb4ba42)


上图中，threshold=0.7和0.5时，具有同样的TPR。但是threshold=0.7的FPR更低一些，所以threshold=0.7是最优的选择。这也就是说AUC-ROC可以帮我们寻找到最优的threshold。

  **核心指标的选择**
  - 准确率：适用于样本分布较为均匀的情况。——实际案例：垃圾电话号码标记
  - 精确率和召回率：适用于样本分布较为不均匀的情况。 ——实际案例：医疗中的癌症筛查
  - F1 分数：综合考虑精确率和召回率，适用于需要平衡这两个指标的情况。——实际案例：垃圾邮件过滤


#### 回归问题的评估
基本概念：回归问题是指预测连续值的任务。评估回归模型的性能通常需要考虑以下几个方面：

![regression](https://github.com/user-attachments/assets/70044912-a59a-41ba-91d9-b34b030a5293)

 
  **核心指标的选择**
  - 均方误差：适用于样本分布较为均匀的情况。对大误差更敏感。
  - 均方根误差：适用于样本分布较为不均匀的情况，如金融欺诈检测。
  - 平均绝对误差：适用于样本分布较为不均匀的情况，如金融欺诈检测。对异常值不敏感。

  总结
  - 准确率适用于简单均衡任务，但无法处理复杂场景。
  - 精确率与召回率需结合使用，避免单一指标的局限性。
  - F1分数是综合两者的最佳选择，尤其适合不平衡数据。
  - 阈值选择需结合ROC/PR曲线、业务需求及优化方法，动态调整以平衡性能。
